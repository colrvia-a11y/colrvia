"use strict";(()=>{var a="v2",R=["/","/offline"];async function l(){await(await caches.open(a)).addAll(R)}var h=e=>e.url.includes("/_next/static/")||e.url.includes("/icons/"),i=e=>e.url.includes("/reveal/"),f=e=>e.url.includes("/api/stories/"),p=e=>e.url.includes("/api/share/")&&e.destination==="image";function o(e){self.clients.matchAll().then(t=>t.forEach(n=>n.postMessage(e)))}async function u(e){let t=await caches.open(a);try{let n=await fetch(e);return i(e)&&t.put(e,n.clone()),n}catch{if(i(e)){let s=await t.match(e);if(s)return s}return await t.match("/offline")||Response.error()}}function d(e){return caches.match(e).then(t=>t||fetch(e).then(n=>(caches.open(a).then(c=>c.put(e,n.clone())),n)))}async function m(e,t){let n=await caches.open(a),c=await n.match(e),s=fetch(e).then(r=>(n.put(e,r.clone()),r)).catch(()=>c);return c?(t.waitUntil(s),c):s}self.addEventListener("install",e=>{e.waitUntil(l().then(()=>self.skipWaiting()))});self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(t=>Promise.all(t.filter(n=>n!==a).map(n=>caches.delete(n)))).then(()=>self.clients.claim()))});self.addEventListener("fetch",e=>{let t=e.request;if(t.mode==="navigate"){e.respondWith(u(t));return}if(h(t)){e.respondWith(d(t));return}(f(t)||p(t))&&e.respondWith(m(t,e))});self.addEventListener("online",()=>o("online"));self.addEventListener("offline",()=>o("offline"));})();
